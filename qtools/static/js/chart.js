// Generated by CoffeeScript 1.7.1

/*
draw main stock chart
 */

(function() {
  var chartline, line1, line2, line3, lines, nodes, offset, point_height, point_width, rectangle, svgCLineContainer, svgContainer, svgMACDContainer, svgRSIContainer, svgVolContainer, x_step;

  x_step = 10;

  chartline = data.length * x_step;

  point_width = 5;

  point_height = 2;


  /*Make an SVG Container */

  svgContainer = d3.select(".chart").append("svg").attr("width", 2000).attr("height", 400);


  /*Draw lines */

  line1 = svgContainer.append("line").attr("x1", 0).attr("y1", 100).attr("x2", chartline).attr("y2", 100).attr("stroke-width", 1).attr("stroke", "black");

  line2 = svgContainer.append("line").attr("x1", 0).attr("y1", 200).attr("x2", chartline).attr("y2", 200).attr("stroke-width", 1).attr("stroke", "black");

  line3 = svgContainer.append("line").attr("x1", 0).attr("y1", 300).attr("x2", chartline).attr("y2", 300).attr("stroke-width", 1).attr("stroke", "black");


  /*draw high and low lines */

  lines = svgContainer.selectAll("line").data(data).enter().append("line").attr("x1", function(d, i) {
    return i * x_step + 3;
  }).attr("y1", function(d) {
    return 600 - d.high * 8;
  }).attr("x2", function(d, i) {
    return i * x_step + 3;
  }).attr("y2", function(d) {
    return 600 - d.low * 8;
  }).attr("stroke-width", 1).attr("stroke", "black");


  /*Draw the Rectangle */

  rectangle = svgContainer.selectAll("rect").data(data).enter().append("rect").attr("x", function(d, i) {
    return i * x_step;
  }).attr("y", function(d) {
    if (d.close > d.open) {
      return 600 - d.close * 8;
    } else {
      return 600 - d.open * 8;
    }
  }).attr("width", point_width).attr("height", function(d) {
    return Math.round(Math.abs(d.close - d.open) * 8);
  }).attr("fill", function(d) {
    if (d.close > d.open) {
      return "#00CC33";
    } else {
      return "#CC0000";
    }
  });


  /*
  vol
   */

  point_width = 2;

  point_height = 2;


  /*Make an SVG Container */

  svgVolContainer = d3.select(".vol").append("svg").attr("width", 2000).attr("height", 150);


  /*Draw lines */

  line1 = svgVolContainer.append("line").attr("x1", 0).attr("y1", 75).attr("x2", chartline).attr("y2", 75).attr("stroke-width", 1).attr("stroke", "black");


  /*Draw the Rectangle */

  rectangle = svgVolContainer.selectAll("rect").data(data).enter().append("rect").attr("x", function(d, i) {
    return i * x_step;
  }).attr("y", function(d) {
    return 150 - (d.volume / 1000000);
  }).attr("width", point_width).attr("height", function(d) {
    return d.volume / 1000000;
  }).attr("fill", "#888888");


  /*
  macd
   */

  offset = 26;


  /*Make an SVG Container */

  svgMACDContainer = d3.select(".macd").append("svg").attr("width", 2000).attr("height", 150);


  /*Draw lines */

  line1 = svgMACDContainer.append("line").attr("x1", 0).attr("y1", 75).attr("x2", chartline).attr("y2", 75).attr("stroke-width", 1).attr("stroke", "black");


  /*Draw the Rectangle */

  rectangle = svgMACDContainer.selectAll("rect").data(macd_line).enter().append("rect").attr("x", function(d, i) {
    return (i + offset) * x_step;
  }).attr("y", function(d) {
    return d * 10 + 75;
  }).attr("width", point_width).attr("height", point_height);

  rectangle = svgMACDContainer.selectAll("rect").data(macd_signal).enter().append("rect").attr("x", function(d, i) {
    return (i + offset) * x_step;
  }).attr("y", function(d) {
    return d * 10 + 75;
  }).attr("width", point_width).attr("height", point_height);


  /*
  RSI
   */

  offset = 10;


  /*Make an SVG Container */

  svgRSIContainer = d3.select(".rsi").append("svg").attr("width", 2000).attr("height", 150);


  /*Draw lines */

  line1 = svgRSIContainer.append("line").attr("x1", 0).attr("y1", 75).attr("x2", chartline).attr("y2", 75).attr("stroke-width", 1).attr("stroke", "black");


  /*Draw the Rectangle */

  rectangle = svgRSIContainer.selectAll("rect").data(rsi_data).enter().append("rect").attr("x", function(d, i) {
    return (i + offset) * x_step;
  }).attr("y", function(d) {
    return d;
  }).attr("width", point_width).attr("height", point_height);


  /*
  draw main stock chart
   */


  /*Make an SVG Container */

  svgCLineContainer = d3.select(".chart_line").append("svg").attr("width", 2000).attr("height", 400).append("svg:g");


  /*Draw lines */

  line1 = svgCLineContainer.append("line").attr("x1", 0).attr("y1", 100).attr("x2", chartline).attr("y2", 100).attr("stroke-width", 1).attr("stroke", "black");

  line2 = svgCLineContainer.append("line").attr("x1", 0).attr("y1", 200).attr("x2", chartline).attr("y2", 200).attr("stroke-width", 1).attr("stroke", "black");

  line3 = svgCLineContainer.append("line").attr("x1", 0).attr("y1", 300).attr("x2", chartline).attr("y2", 300).attr("stroke-width", 1).attr("stroke", "black");

  nodes = function(data, i) {
    return {
      x: i * x_step,
      y: data.close
    };
  };

  svgCLineContainer.selectAll("circle.nodes").data(nodes).enter().append("svg:circle").attr("cx", function(d) {
    return d.x;
  }).attr("cy", function(d) {
    return d.y;
  });

  svgCLineContainer.selectAll("circle.nodes").data(nodes).enter().append("svg:circle").attr("cx", function(d) {
    return d.x;
  }).attr("cy", function(d) {
    return d.y;
  }).attr("r", "10px").attr("fill", "black");

}).call(this);
